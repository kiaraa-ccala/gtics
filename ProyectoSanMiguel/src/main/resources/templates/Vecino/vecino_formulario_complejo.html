<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <!-- [Head] start -->

  <head th:replace="~{fragments/head_vecino :: head('Agregar Usuario')}"></head>
  
  <body data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-layout="vertical" data-pc-direction="ltr" data-pc-theme_contrast="" data-pc-theme="light">

    <div class="loader-bg">
  <div class="loader-track">
    <div class="loader-fill"></div>
  </div>
</div>


    <div th:replace="~{fragments/Sidebar_vecino :: sidebar}"></div>


    <div th:replace="~{fragments/navbar_vecino :: header}"></div>


        <!-- [ Main Content ] start -->
        <div class="pc-container" style="background: #e0f6ff">
            <div class="pc-content">
              <!-- [ breadcrumb ] start -->
              <div class="page-header">
                <div class="page-block">
                  <div class="row align-items-center">
                    <div class="col-md-12">
                      
                    </div>
                    <div class="col-md-12">
                      <div class="page-header-title">
                        <h1 class="mb-0">Nueva reserva</h1>
                        <h5 class="mb-0">Complejo deportivo #<span th:text="${complejo.idComplejoDeportivo}"></span></h5>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- [ breadcrumb ] end -->
      

              <!-- [ Main Content ] start -->

              <form th:action="@{/vecino/guardarReserva}" method="post" th:object="${reserva}">
                <div class="container-fluid">
                  <div class="row g-3">

                    <!-- DATOS PERSONALES -->
                    <div class="col-12 col-lg-8">
                      <div class="card h-100">
                        <div class="card-header">
                          <h4 class="mb-0">Datos personales</h4>
                        </div>
                        <div class="card-body">
                          <div class="row">
                            <div class="col-md-6 mb-3">
                              <label class="form-label">Nombres</label>
                              <input type="text" class="form-control" placeholder="Ingrese el nombre" th:field="*{usuario.nombre}" readonly/>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">Apellidos</label>
                              <input type="text" class="form-control" placeholder="Ingrese los apellidos" th:field="*{usuario.apellido}" readonly/>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">Correo electr√≥nico</label>
                              <input type="email" class="form-control" placeholder="Ingrese el correo electr√≥nico" th:field="*{usuario.credencial.correo}" readonly/>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">DNI</label>
                              <input type="text" class="form-control" placeholder="Ingrese el DNI" th:field="*{usuario.dni}" readonly/>
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">Tel√©fono</label>
                              <input type="tel" class="form-control" placeholder="Ingrese su tel√©fono" th:field="*{usuario.telefono}" readonly/>
                            </div>

                            <div class="col-md-6 mb-3" hidden>
                              <label class="form-label">Tipo de persona</label>
                              <select class="form-select">
                                <option value="1">Persona Natural</option>
                                <option value="2">Persona Jur√≠dica</option>
                              </select>
                            </div>

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Direcci√≥n</label>
                              <input type="text" class="form-control" placeholder="Ingrese su direcci√≥n" th:field="*{usuario.direccion}" readonly/>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- INFORMACI√ìN DEL CAMPO -->
                    <div class="col-12 col-lg-4">
                      <div class="card h-100">
                        <div class="card-header">
                          <h4 class="mb-0">Informaci√≥n del campo</h4>
                        </div>
                        <div class="card-body">
                          <div class="row">

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Selecciona el campo</label>
                              <select class="form-select" th:field="*{instanciaServicio.idInstanciaServicio}" id="selectInstancia" required>
                                <option value="" disabled selected>-- Selecciona una cancha --</option>
                                <option th:each="i : ${instanciaServicios}"
                                        th:value="${i.idInstanciaServicio}"
                                        th:text="${i.nombre}"></option>
                              </select>
                            </div>

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Seleccione fecha</label>
                              <input id="inputFecha" class="form-control" th:field="*{fecha}" placeholder="Selecciona una fecha" readonly />

                            </div>



                            <div class="col-md-12 mb-3">
                            <label class="form-label">Horario disponible</label>
                              <select class="form-select" name="bloqueHorario" id="selectHorario" required>
                                <option value="">-- Selecciona un horario --</option>
                                <option value="08:00-10:00">08:00 ‚Äì 10:00</option>
                                <option value="10:00-12:00">10:00 ‚Äì 12:00</option>
                                <option value="12:00-14:00">12:00 ‚Äì 14:00</option>
                              </select>

                            </div>

                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- BOT√ìN DE RESERVA -->
                    <div class="text-center">
                      <button type="submit" class="btn btn-lg btn-primary" style="width: 200px;">
                        <i class="bi bi-credit-card me-2"></i> Reservar
                      </button>
                    </div>

                  </div>
                </div>
              </form>

              <!-- [ Main Content ] end -->
            </div>
        </div>

    <div th:replace="~{fragments/footer_superadmin :: footer}"></div>
    <!-- Required Js -->
    <script th:src="@{/assets/js/plugins/popper.min.js}"></script>
    <script th:src="@{/assets/js/plugins/simplebar.min.js}"></script>
    <script th:src="@{/assets/js/plugins/bootstrap.min.js}"></script>

    <script th:src="@{/assets/js/plugins/i18next.min.js}"></script>
    <script th:src="@{/assets/js/plugins/i18nextHttpBackend.min.js}"></script>

    <script th:src="@{/assets/js/icon/custom-font.js}"></script>
    <script th:src="@{/assets/js/script.js}"></script>
    <script th:src="@{/assets/js/theme.js}"></script>
    <script th:src="@{/assets/js/multi-lang.js}"></script>
    <script th:src="@{/assets/js/plugins/feather.min.js}"></script>


    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">




    <script>
  layout_change('light');
</script>
  
<script>
  change_box_container('false');
</script>
 
<script>
  layout_caption_change('true');
</script>
 
<script>
  layout_rtl_change('false');
</script>
 
<script>
  preset_change('preset-1');
</script>
 
<script>
  main_layout_change('vertical');
</script>


    <!-- [Page Specific JS] start -->
    <script>
      // scroll-block
      var tc = document.querySelectorAll('.scroll-block');
      for (var t = 0; t < tc.length; t++) {
        new SimpleBar(tc[t]);
      }
    </script>

    <style>
      #basic-btn_info {
        display: none !important;
      }

      /* √çtems del men√∫: blanco */
      .pc-sidebar .pc-link,
      .pc-sidebar .pc-mtext,
      .pc-sidebar .pc-micon {
        color: #ffffff !important;
        opacity: 1 !important;
      }

      /* T√≠tulos de secciones del men√∫ */
      .pc-sidebar .menu-caption,
      .pc-sidebar .pc-caption {
        color: rgba(255, 255, 255, 0.6) !important;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 12px;
      }
      /* Hover: cambia el texto a celeste claro */
      .pc-sidebar .pc-link:hover,
      .pc-sidebar .pc-link:focus {
        background-color: rgba(255, 255, 255, 0.05); /* Fondo sutil */
        transition: all 0.2s ease-in-out;
      }
      .ecom-wrapper {
        display: flex;
        justify-content: center; /* üí° centra horizontalmente */
      }

      .ecom-content {
        max-width: 1200px; /* o el ancho que quieras */
        width: 100%;
        padding: 1rem;
      }
    </style>
   
  
    <!-- Modal HTML con las clases CSS -->
<div class="modal fade cart-modal" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cartModalLabel">Servicio agregado al carrito</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="service-name">Nombre del servicio o actividad</p>
          <p class="service-item">RESERVA CANCHA 1</p>
          <p class="service-price">S/. 80.00</p>
          <p class="service-item">MEMBRESIA GYM</p>
          <p class="service-price">S/. 60.00</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Seguir comprando</button>
          <button type="button" class="btn btn-primary">Ir al carro</button>
        </div>
      </div>
    </div>
  </div>
  
    <style>
        /* Estilos para el modal */
        .cart-modal {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          border-radius: 10px;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
          border: none;
        }
        
        .cart-modal .modal-header {
          background-color: #f8f9fa;
          border-bottom: 1px solid #dee2e6;
          border-radius: 10px 10px 0 0;
          padding: 15px 20px;
        }
        
        .cart-modal .modal-title {
          color: #212529;
          font-weight: 600;
          font-size: 1.3rem;
        }
        
        .cart-modal .modal-body {
          padding: 20px;
        }
        
        .cart-modal .service-name {
          color: #6c757d;
          margin-bottom: 5px;
          font-size: 0.9rem;
        }
        
        .cart-modal .service-item {
          font-weight: 500;
          margin: 10px 0;
          padding: 8px 0;
          border-bottom: 1px dashed #eee;
        }
        
        .cart-modal .service-price {
          font-weight: 600;
          color: #0d6efd;
          margin: 10px 0;
        }
        
        .cart-modal .modal-footer {
          border-top: none;
          padding: 15px 20px;
          display: flex;
          justify-content: space-between;
        }
        
        .cart-modal .btn-secondary {
          background-color: #6c757d;
          border: none;
          padding: 8px 20px;
        }
        
        .cart-modal .btn-primary {
          background-color: #0d6efd;
          border: none;
          padding: 8px 25px;
        }
        
        .cart-modal .btn-secondary:hover {
          background-color: #5a6268;
        }
        
        .cart-modal .btn-primary:hover {
          background-color: #0b5ed7;
        }
      </style>


    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const inputFecha = document.getElementById("inputFecha");
        const selectInstancia = document.getElementById("selectInstancia");
        const selectHorario = document.getElementById("selectHorario");

        let fechasDisponibles = [];
        let flatpickrInstance = null;

        selectInstancia.addEventListener("change", function () {
          const id = this.value;

          // Reset horarios
          selectHorario.innerHTML = '<option value="">-- Selecciona un horario --</option>';

          // Obtener fechas disponibles
          fetch(`/api/complejos/fechasDisponibles?idInstancia=${id}`)
                  .then(res => res.json())
                  .then(fechas => {
                    fechasDisponibles = fechas;

                    if (flatpickrInstance) flatpickrInstance.destroy();

                    flatpickrInstance = flatpickr(inputFecha, {
                      locale: "es",
                      dateFormat: "Y-m-d",
                      enable: fechasDisponibles,
                      onChange: function (selectedDates, dateStr) {
                        if (dateStr) {
                          cargarHorasDisponibles(id, dateStr);
                        }
                      }
                    });
                  });
        });

        function cargarHorasDisponibles(idInstancia, fecha) {
          fetch(`/api/complejos/disponibilidad?idInstancia=${idInstancia}&fecha=${fecha}`)
                  .then(res => res.json())
                  .then(data => {
                    selectHorario.innerHTML = '<option value="">-- Selecciona un horario --</option>';

                    if (data.fechaLlena || !data.bloques || data.bloques.length === 0) {
                      alert("No hay horarios disponibles para esta fecha.");
                      return;
                    }

                    data.bloques.forEach(bloque => {
                      const horas = bloque.horasDisponibles;
                      for (let i = 0; i < horas.length - 1; i++) {
                        const h1 = horas[i];
                        const h2 = horas[i + 1];

                        // Verificar que sean consecutivas
                        const h1Num = parseInt(h1.split(':')[0]);
                        const h2Num = parseInt(h2.split(':')[0]);

                        if (h2Num === h1Num + 1) {
                          const label = `${h1} ‚Äì ${h2} (S/ ${bloque.monto})`;
                          const value = `${h1}-${h2}`;
                          const opt = new Option(label, value);
                          selectHorario.add(opt);
                        }
                      }
                    });
                  });
        }
      });
    </script>

    </script>




  </body>
  <!-- [Body] end -->
</html>
