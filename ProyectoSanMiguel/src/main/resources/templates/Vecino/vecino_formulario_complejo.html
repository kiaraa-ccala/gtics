<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <!-- [Head] start -->

  <head th:replace="fragments/head_vecino :: head('Nueva reserva')"></head>
  
  <body data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-layout="vertical" data-pc-direction="ltr" data-pc-theme_contrast="" data-pc-theme="light">

    <div class="loader-bg">
  <div class="loader-track">
    <div class="loader-fill"></div>
  </div>
</div>


    <div th:replace="fragments/Sidebar_vecino :: sidebar"></div>


    <header class="pc-header">
      <div class="header-wrapper" style="background: #FFFFFF"> <!-- [Mobile Media Block] start -->
        <div class="me-auto pc-mob-drp">
          <ul class="list-unstyled">
            <!-- ======= Menu collapse Icon ===== -->
            <li class="pc-h-item pc-sidebar-collapse">
              <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
                <i class="ti ti-menu-2"></i>
              </a>
            </li>
            <li class="pc-h-item pc-sidebar-popup">
              <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
                <i class="ti ti-menu-2"></i>
              </a>
            </li>
            <li class="pc-h-item d-none d-md-inline-flex">
              <form class="form-search">
                <i class="bi bi-search"></i>

                <input type="search" class="form-control" placeholder="Buscar" />
              </form>
            </li>
          </ul>
        </div>
        <!-- [Mobile Media Block end] -->
        <div class="ms-auto">
          <ul class="list-unstyled">

            <li class="d-flex justify-content-center align-items-center">
              <span class="badge bg-light-success rounded-pill ms-2 theme-version">
                vecino
              </span>
            </li>
            <li class="dropdown pc-h-item">
              <a
                      class="pc-head-link dropdown-toggle arrow-none me-0"
                      data-bs-toggle="dropdown"
                      href="#"
                      role="button"
                      aria-haspopup="false"
                      aria-expanded="false"
              >
                <svg class="pc-icon">
                  <use xlink:href="#custom-notification"></use>
                </svg>
                <span class="badge bg-success pc-h-badge">3</span>
              </a>
              <div class="dropdown-menu dropdown-notification dropdown-menu-end pc-h-dropdown">
                <div class="dropdown-header d-flex align-items-center justify-content-between">
                  <h5 class="m-0">Notificaciones</h5>
                  <a href="#!" class="btn btn-link btn-sm">Marcar todo como leído</a>
                </div>
                <div class="dropdown-body text-wrap header-notification-scroll position-relative" style="max-height: calc(100vh - 215px)">
                  <p class="text-span">Hoy</p>
                  <div class="card mb-2">
                    <div class="card-body">
                      <div class="d-flex">
                        <div class="flex-shrink-0">
                          <svg class="pc-icon text-primary">
                            <use xlink:href="#custom-layer"></use>
                          </svg>
                        </div>
                        <div class="flex-grow-1 ms-3">
                          <span class="float-end text-sm text-muted">hace 2 min</span>
                          <h5 class="text-body mb-2">¡Descuento del 20% en tu próxima reserva!</h5>
                          <p class="mb-0"
                          >¡Hola Kiara! Como agradecimiento por ser parte de San Miguel, te regalamos un 20% de descuento en tu próxima reserva de gimnasio o canchas durante este mes. Usa el código SANMIGUEL20 al reservar en nuestra plataforma. ¡Aprovecha esta oferta antes de que expire!</p
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card mb-2">
                    <div class="card-body">
                      <div class="d-flex">
                        <div class="flex-shrink-0">
                          <svg class="pc-icon text-primary">
                            <use xlink:href="#custom-sms"></use>
                          </svg>
                        </div>
                        <div class="flex-grow-1 ms-3">
                          <span class="float-end text-sm text-muted">hace 1 hora</span>
                          <h5 class="text-body mb-2">Reserva cancelada - Lo sentimos</h5>
                          <p class="mb-0">Estimado/a Kiara, lamentamos informarte que tu reserva en la Pista de Atletismo (Centro Atlético NovaFit) para el [Fecha] ha sido cancelada por trabajos de mantenimiento. Hemos reembolsado tu pago o puedes reagendar aquí: [Enlace]. ¡Disculpas por las molestias!</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <p class="text-span">Ayer</p>
                  <div class="card mb-2">
                    <div class="card-body">
                      <div class="d-flex">
                        <div class="flex-shrink-0">
                          <svg class="pc-icon text-primary">
                            <use xlink:href="#custom-document-text"></use>
                          </svg>
                        </div>
                        <div class="flex-grow-1 ms-3">
                          <span class="float-end text-sm text-muted">hace 2 horas</span>
                          <h5 class="text-body mb-2">Reserva del complejo</h5>
                          <p class="mb-0"
                          >¡Hola Kiara! Tu reserva para la Cancha de Fútbol (Losa) en el Complejo Deportivo El Mirador ha sido confirmada para el [Fecha] a las [Hora]. Recuerda presentar tu código QR al ingresar. ¡Gracias por preferirnos!</p
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="text-center py-2">
                  <a href="#!" class="link-danger">Vaciar bandeja</a>
                </div>
              </div>
            </li>
            <li class="dropdown pc-h-item header-user-profile">
              <a
                      class="pc-head-link dropdown-toggle arrow-none me-0"
                      data-bs-toggle="dropdown"
                      href="#"
                      role="button"
                      aria-haspopup="false"
                      data-bs-auto-close="outside"
                      aria-expanded="false"
              >
                <img src="../assets/images/user/avatar-2.jpg" alt="user-image" class="user-avtar" />
              </a>
              <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown">
                <div class="dropdown-header d-flex align-items-center justify-content-between">
                  <h5 class="m-0">Mi perfil</h5>
                </div>
                <div class="dropdown-body">
                  <div class="profile-notification-scroll position-relative" style="max-height: calc(100vh - 225px)">
                    <div class="d-flex mb-1">
                      <div class="flex-shrink-0">
                        <img src="../assets/images/user/avatar-2.jpg" alt="user-image" class="user-avtar wid-35" />
                      </div>
                      <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1"> Vecino </h6>
                        <span>kiara.ccala@sanmi.gob.pe</span>
                      </div>
                    </div>
                    <hr class="border-secondary border-opacity-50" />
                    <div class="card">
                      <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between">
                          <h5 class="mb-0 d-inline-flex align-items-center"
                          ><svg class="pc-icon text-muted me-2">
                            <use xlink:href="#custom-notification-outline"></use></svg>Notificaciones</h5>
                          <div class="form-check form-switch form-check-reverse m-0">
                            <input class="form-check-input f-18" type="checkbox" role="switch" />
                          </div>
                        </div>
                      </div>
                    </div>
                    <hr class="border-secondary border-opacity-50" />
                    <p class="text-span">Usuarios</p>



                    <a href="#" class="dropdown-item">
              <span>
                <i class="bi bi-person-fill-add text-muted me-2"></i>

                <span>Agregar</span>
              </span>
                    </a>


                    <hr class="border-secondary border-opacity-50" />
                    <div class="d-grid mb-3">
                      <button class="btn btn-primary">
                        <svg class="pc-icon me-2">
                          <use xlink:href="#custom-logout-1-outline"></use></svg>Salir
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </header>


        <!-- [ Main Content ] start -->
        <div class="pc-container" style="background: #e0f6ff">
            <div class="pc-content">
              <!-- [ breadcrumb ] start -->
              <div class="page-header">
                <div class="page-block">
                  <div class="row align-items-center">
                    <div class="col-md-12">
                      
                    </div>
                    <div class="col-md-12">
                      <div class="page-header-title">
                        <h1 class="mb-0">Nueva reserva</h1>
                        <h5 class="mb-0">Complejo deportivo #20</h5>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- [ breadcrumb ] end -->
      

              <!-- [ Main Content ] start -->

              <form th:action="@{/vecino/guardarReserva}" method="post" th:object="${reserva}">
                <div class="container-fluid">
                  <div class="row g-3">

                    <!-- DATOS PERSONALES -->
                    <div class="col-12 col-lg-8">
                      <div class="card h-100">
                        <div class="card-header">
                          <h4 class="mb-0">Datos personales</h4>
                        </div>
                        <div class="card-body">
                          <div class="row">
                            <div class="col-md-6 mb-3">
                              <label class="form-label">Nombres</label>
                              <input type="text" class="form-control" placeholder="Ingrese el nombre" th:field="*{usuario.nombre}" />
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">Apellidos</label>
                              <input type="text" class="form-control" placeholder="Ingrese los apellidos" th:field="*{usuario.apellido}" />
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">Correo electrónico</label>
                              <input type="email" class="form-control" placeholder="Ingrese el correo electrónico" th:field="*{usuario.credencial.correo}" />
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">DNI</label>
                              <input type="text" class="form-control" placeholder="Ingrese el DNI" th:field="*{usuario.dni}" />
                            </div>

                            <div class="col-md-6 mb-3">
                              <label class="form-label">Teléfono</label>
                              <input type="tel" class="form-control" placeholder="Ingrese su teléfono" th:field="*{usuario.telefono}" />
                            </div>

                            <div class="col-md-6 mb-3" hidden>
                              <label class="form-label">Tipo de persona</label>
                              <select class="form-select">
                                <option value="1">Persona Natural</option>
                                <option value="2">Persona Jurídica</option>
                              </select>
                            </div>

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Dirección</label>
                              <input type="text" class="form-control" placeholder="Ingrese su dirección" th:field="*{usuario.direccion}" />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- INFORMACIÓN DEL CAMPO -->
                    <div class="col-12 col-lg-4">
                      <div class="card h-100">
                        <div class="card-header">
                          <h4 class="mb-0">Información del campo</h4>
                        </div>
                        <div class="card-body">
                          <div class="row">

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Selecciona el campo</label>
                              <select class="form-select" th:field="*{instanciaServicio.idInstanciaServicio}" id="selectInstancia">
                                <option value="" disabled selected>-- Selecciona una cancha --</option>
                                <option th:each="i : ${instanciaServicios}"
                                        th:value="${i.idInstanciaServicio}"
                                        th:text="${i.nombre}"></option>
                              </select>
                            </div>

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Seleccione fecha</label>
                              <input type="date" id="inputFecha" class="form-control" th:field="*{fecha}" />

                            </div>

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Hora inicio</label>
                              <select class="form-select" id="inputHoraInicio" th:field="*{horaInicio}">
                                <option value="">-- Selecciona hora inicio --</option>
                              </select>
                            </div>

                            <div class="col-md-12 mb-3">
                              <label class="form-label">Hora fin</label>
                              <select class="form-select" id="inputHoraFin" th:field="*{horaFin}">
                                <option value="">-- Selecciona hora fin --</option>
                              </select>
                            </div>

                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- BOTÓN DE RESERVA -->
                    <div class="text-center">
                      <button type="submit" class="btn btn-lg btn-primary" style="width: 200px;">
                        <i class="bi bi-credit-card me-2"></i> Reservar
                      </button>
                    </div>

                  </div>
                </div>
              </form>

              <!-- [ Main Content ] end -->
            </div>
        </div>

    <div th:replace="fragments/footer_superadmin :: footer"></div>
    <!-- Required Js -->
    <script th:src="@{/assets/js/plugins/popper.min.js}"></script>
    <script th:src="@{/assets/js/plugins/simplebar.min.js}"></script>
    <script th:src="@{/assets/js/plugins/bootstrap.min.js}"></script>

    <script th:src="@{/assets/js/plugins/i18next.min.js}"></script>
    <script th:src="@{/assets/js/plugins/i18nextHttpBackend.min.js}"></script>

    <script th:src="@{/assets/js/icon/custom-font.js}"></script>
    <script th:src="@{/assets/js/script.js}"></script>
    <script th:src="@{/assets/js/theme.js}"></script>
    <script th:src="@{/assets/js/multi-lang.js}"></script>
    <script th:src="@{/assets/js/plugins/feather.min.js}"></script>



<script>
  layout_change('light');
</script>
  
<script>
  change_box_container('false');
</script>
 
<script>
  layout_caption_change('true');
</script>
 
<script>
  layout_rtl_change('false');
</script>
 
<script>
  preset_change('preset-1');
</script>
 
<script>
  main_layout_change('vertical');
</script>


    <!-- [Page Specific JS] start -->
    <script>
      // scroll-block
      var tc = document.querySelectorAll('.scroll-block');
      for (var t = 0; t < tc.length; t++) {
        new SimpleBar(tc[t]);
      }
    </script>

    <style>
      #basic-btn_info {
        display: none !important;
      }

      /* Ítems del menú: blanco */
      .pc-sidebar .pc-link,
      .pc-sidebar .pc-mtext,
      .pc-sidebar .pc-micon {
        color: #ffffff !important;
        opacity: 1 !important;
      }

      /* Títulos de secciones del menú */
      .pc-sidebar .menu-caption,
      .pc-sidebar .pc-caption {
        color: rgba(255, 255, 255, 0.6) !important;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 12px;
      }
      /* Hover: cambia el texto a celeste claro */
      .pc-sidebar .pc-link:hover,
      .pc-sidebar .pc-link:focus {
        background-color: rgba(255, 255, 255, 0.05); /* Fondo sutil */
        transition: all 0.2s ease-in-out;
      }
      .ecom-wrapper {
        display: flex;
        justify-content: center; /* 💡 centra horizontalmente */
      }

      .ecom-content {
        max-width: 1200px; /* o el ancho que quieras */
        width: 100%;
        padding: 1rem;
      }
    </style>
   
  
    <!-- Modal HTML con las clases CSS -->
<div class="modal fade cart-modal" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cartModalLabel">Servicio agregado al carrito</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="service-name">Nombre del servicio o actividad</p>
          <p class="service-item">RESERVA CANCHA 1</p>
          <p class="service-price">S/. 80.00</p>
          <p class="service-item">MEMBRESIA GYM</p>
          <p class="service-price">S/. 60.00</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Seguir comprando</button>
          <button type="button" class="btn btn-primary">Ir al carro</button>
        </div>
      </div>
    </div>
  </div>
  
    <style>
        /* Estilos para el modal */
        .cart-modal {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          border-radius: 10px;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
          border: none;
        }
        
        .cart-modal .modal-header {
          background-color: #f8f9fa;
          border-bottom: 1px solid #dee2e6;
          border-radius: 10px 10px 0 0;
          padding: 15px 20px;
        }
        
        .cart-modal .modal-title {
          color: #212529;
          font-weight: 600;
          font-size: 1.3rem;
        }
        
        .cart-modal .modal-body {
          padding: 20px;
        }
        
        .cart-modal .service-name {
          color: #6c757d;
          margin-bottom: 5px;
          font-size: 0.9rem;
        }
        
        .cart-modal .service-item {
          font-weight: 500;
          margin: 10px 0;
          padding: 8px 0;
          border-bottom: 1px dashed #eee;
        }
        
        .cart-modal .service-price {
          font-weight: 600;
          color: #0d6efd;
          margin: 10px 0;
        }
        
        .cart-modal .modal-footer {
          border-top: none;
          padding: 15px 20px;
          display: flex;
          justify-content: space-between;
        }
        
        .cart-modal .btn-secondary {
          background-color: #6c757d;
          border: none;
          padding: 8px 20px;
        }
        
        .cart-modal .btn-primary {
          background-color: #0d6efd;
          border: none;
          padding: 8px 25px;
        }
        
        .cart-modal .btn-secondary:hover {
          background-color: #5a6268;
        }
        
        .cart-modal .btn-primary:hover {
          background-color: #0b5ed7;
        }
      </style>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const inputFecha = document.getElementById("inputFecha");
        const selectInstancia = document.getElementById("selectInstancia");
        const inputHoraInicio = document.getElementById("inputHoraInicio");
        const inputHoraFin = document.getElementById("inputHoraFin");

        let fechasDisponibles = [];

        // Al cambiar de cancha
        selectInstancia.addEventListener("change", function () {
          const id = this.value;

          // Limpiar campos
          inputFecha.value = "";
          inputHoraInicio.innerHTML = '<option value="">-- Selecciona hora --</option>';
          inputHoraFin.innerHTML = '<option value="">-- Selecciona hora --</option>';

          // Obtener fechas con horarios disponibles
          fetch(`/api/complejos/fechasDisponibles?idInstancia=${id}`)
                  .then(res => res.json())
                  .then(fechas => {
                    fechasDisponibles = fechas;

                    if (fechasDisponibles.length === 0) {
                      inputFecha.setAttribute("disabled", "disabled");
                      alert("No hay fechas disponibles para esta cancha.");
                      return;
                    }

                    inputFecha.removeAttribute("disabled");
                    inputFecha.setAttribute("min", fechasDisponibles[0]);
                    inputFecha.setAttribute("max", fechasDisponibles[fechasDisponibles.length - 1]);
                  });
        });

        // Al cambiar la fecha
        inputFecha.addEventListener("change", function () {
          const fecha = this.value;
          const idInstancia = selectInstancia.value;

          if (!fechasDisponibles.includes(fecha)) {
            alert("Esta fecha no tiene horarios disponibles.");
            this.value = "";
            inputHoraInicio.innerHTML = '<option value="">-- Selecciona hora --</option>';
            inputHoraFin.innerHTML = '<option value="">-- Selecciona hora --</option>';
            return;
          }

          // Si la fecha está permitida, consultar horas libres
          fetch(`/api/complejos/disponibilidad?idInstancia=${idInstancia}&fecha=${fecha}`)
                  .then(res => res.json())
                  .then(data => {
                    const ocupadas = new Set(data.horas || []);

                    inputHoraInicio.innerHTML = '<option value="">-- Selecciona hora --</option>';
                    inputHoraFin.innerHTML = '<option value="">-- Selecciona hora --</option>';

                    for (let h = 7; h < 22; h++) {
                      const hora = `${String(h).padStart(2, '0')}:00`;
                      if (!ocupadas.has(hora)) {
                        inputHoraInicio.innerHTML += `<option value="${hora}">${hora}</option>`;
                        inputHoraFin.innerHTML += `<option value="${hora}">${hora}</option>`;
                      }
                    }
                  });
        });
      });
    </script>



  </body>
  <!-- [Body] end -->
</html>
